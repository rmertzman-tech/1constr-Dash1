<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Constructor's Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .view { display: none; }
        .view.active { display: block; }
        .loader {
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #d1d5db;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        .chat-bubble-user {
            background-color: #dbeafe;
            align-self: flex-end;
        }
        .chat-bubble-model {
            background-color: #e5e7eb;
            align-self: flex-start;
        }
        .tab-btn {
            transition: all 0.2s ease-in-out;
        }
        .tab-btn.active {
            border-color: #3b82f6;
            color: #3b82f6;
            background-color: #eff6ff;
        }
        .ai-response-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .ai-response-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .ai-response-card p, .ai-response-card ul, .ai-response-card div {
            color: #4b5563;
        }
        .ai-response-card ul {
            list-style-position: inside;
            padding-left: 0.5rem;
        }
        .synergy-lab-locked {
            opacity: 0.5;
            pointer-events: none;
        }
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 1rem; /* for scrollbar */
        }
        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #9ca3af;
        }
        .modal-close-btn:hover {
            color: #1f2937;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app" class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">The Constructor's Dashboard</h1>
            <p class="text-lg text-gray-600 mt-2">Ethical Navigation & Identity Construction (FAIM-QIRF Aligned)</p>
        </header>

        <!-- Main Content Area -->
        <main>
            <!-- Global Action Buttons -->
            <div id="action-buttons" class="text-center mb-8 space-x-2 sm:space-x-4">
                <button id="start-here-btn" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-blue-700 transition-colors">Start Here</button>
                <button id="abcd-mindset-btn" class="bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-teal-700 transition-colors">ABCD Constructor's Mindset</button>
                <button id="load-demo-btn" class="bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-gray-600 transition-colors">Load Demo</button>
                <button id="clear-work-btn" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-red-700 transition-colors">Clear My Work</button>
            </div>

            <!-- Tab Navigation -->
            <div class="mb-8 flex flex-wrap justify-center border-b border-gray-300">
                <button class="tab-btn active font-semibold py-3 px-6 border-b-2 border-transparent" data-view="prf-constructor-view">1. PRF Constructor</button>
                <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="cps-dashboard-view">2. CPS Dashboard</button>
                <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="broa-lab-view">3. BROA Filter Lab</button>
                <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="abcd-lab-view">4. ABCD Mindset</button>
                <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="sage-lab-view">5. SAGE Design Lab</button>
                <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="lens-lab-view">6. Ethical Lens Navigator</button>
                <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="justice-lab-view">7. Justice Lab</button>
                <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="tech-lab-view">8. Technology Lab</button>
                 <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="env-lab-view">9. Environmental Lab</button>
                 <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="health-lab-view">10. Healthcare Lab</button>
                 <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="education-lab-view">11. Education Lab</button>
                 <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="politics-lab-view">12. Politics Lab</button>
                 <button class="tab-btn font-semibold py-3 px-6 border-b-2 border-transparent" data-view="legacy-lab-view">13. Legacy Project</button>
            </div>

            <div id="main-content">
                <!-- View 1: PRF Constructor -->
                <div id="prf-constructor-view" class="view active bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <h2 class="text-3xl font-bold mb-2">Personal Reality Framework (PRF) Constructor</h2>
                    <p class="mb-8 text-gray-600">Your PRF is the deep, evolving structure of your ethical self. Use this lab to systematically map its components: your history, your perceptual filters, and your coherence over time.</p>
                    <div class="space-y-8">
                        <div>
                            <h3 class="text-2xl font-semibold mb-2 text-gray-700">1. My Assembly History</h3>
                            <p class="mb-3 text-gray-500">What key life events have fundamentally shaped your ethical and moral compass?</p>
                            <p class="text-sm text-gray-500 mb-2">Consider: A time you faced a major ethical dilemma; your role models (positive or negative); books or ideas that changed your perspective; how your cultural background shaped your sense of responsibility.</p>
                            <textarea id="prf-history" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., A formative experience in college, a book that changed my perspective..."></textarea>
                        </div>
                        <div>
                            <h3 class="text-2xl font-semibold mb-2 text-gray-700">2. My BROA Filter</h3>
                            <p class="mb-3 text-gray-500">Based on your history, define the core components of your current ethical filter.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="prf-beliefs" class="block text-lg font-semibold mb-2">Beliefs:</label>
                                    <p class="text-sm text-gray-500 mb-2">Consider: Are people fundamentally good or self-interested? Is the world just or unjust? What is the purpose of a community?</p>
                                    <textarea id="prf-beliefs" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'I believe that context is more important than rigid rules...'"></textarea>
                                </div>
                                <div>
                                    <label for="prf-rules" class="block text-lg font-semibold mb-2">Rules:</label>
                                    <p class="text-sm text-gray-500 mb-2">Consider: 'When someone is in need, I should...'; 'When I make a mistake, I should...'; 'A promise should be kept, unless...'</p>
                                    <textarea id="prf-rules" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'The primary rule is to seek understanding before judgment.'"></textarea>
                                </div>
                                <div>
                                    <label for="prf-ontology" class="block text-lg font-semibold mb-2">Ontology:</label>
                                    <p class="text-sm text-gray-500 mb-2">Consider: Is an obstacle a threat, test, or opportunity? Is a disagreement a battle to win or a problem to solve? Do you see bad actors or broken systems?</p>
                                    <textarea id="prf-ontology" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'I see ethical dilemmas not as right-vs-wrong choices, but as complex systems...'"></textarea>
                                </div>
                                <div>
                                    <label for="prf-authenticity" class="block text-lg font-semibold mb-2">Authenticity:</label>
                                    <p class="text-sm text-gray-500 mb-2">Consider: A time you felt perfectly aligned with your values; what inauthenticity feels like; 'I am true to myself when I am...'; What would betray your core self?</p>
                                    <textarea id="prf-authenticity" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'It feels most authentic to me to act as a mediator...'"></textarea>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-2xl font-semibold mb-2 text-gray-700">3. My Adaptive Temporal Consistency Function (ATCF)</h3>
                            <p class="mb-3 text-gray-500">Reflect on how your PRF adapts and maintains coherence over time. This function measures your ethical self's integrity across past, present, and future.</p>
                            <div class="space-y-4">
                                <div>
                                    <label for="prf-historical-continuity" class="block text-lg font-semibold mb-2">Historical Continuity:</label>
                                    <p class="text-sm text-gray-500 mb-2">Consider: How have your core values evolved over time? What caused them to change? How have you integrated past failures into who you are today?</p>
                                    <textarea id="prf-historical-continuity" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'My framework evolved from a simple 'be nice' to a more complex 'build just systems' after...'"></textarea>
                                </div>
                                <div>
                                    <label for="prf-prospective-coherence" class="block text-lg font-semibold mb-2">Prospective Coherence:</label>
                                    <p class="text-sm text-gray-500 mb-2">Consider: Imagine yourself in 5 years. What capabilities does that future self have that you are building today? How do your current major life choices align with that future projection?</p>
                                    <textarea id="prf-prospective-coherence" rows="3" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'I want my framework to become more robust in confronting bad actors without losing its compassion.'"></textarea>
                                </div>
                                <div>
                                    <label for="prf-meta-capacity" class="block text-lg font-semibold mb-2">Meta-Constructor Capacity:</label>
                                    <p class="text-sm text-gray-500 mb-2">Consider: What is your process for self-reflection? When you notice a conflict between two values, what is your method for resolving it? How do you decide when a belief needs to be updated?</p>
                                    <textarea id="prf-meta-capacity" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'I reflect on my framework when I feel a conflict between a rule and my authenticity...'"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="prf-synthesize-btn" class="mt-8 bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700">Synthesize My PRF & ATCF</button>
                    <div id="prf-result" class="mt-6"></div>
                </div>

                <!-- View 2: CPS Dashboard -->
                <div id="cps-dashboard-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="mb-12 border-b border-gray-200 pb-8">
                        <h2 class="text-3xl font-bold mb-2">Your Identity Kernel</h2>
                        <p class="mb-6 text-gray-600">Reflect on the prompts below to draft a statement that captures your core.</p>
                        <div class="space-y-4">
                            <div><label for="ik-values" class="block text-lg font-semibold mb-2">What core values guide you?</label><textarea id="ik-values" rows="3" class="savable w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., Honesty, compassion..."></textarea></div>
                            <div><label for="ik-relationships" class="block text-lg font-semibold mb-2">What key relationships define you?</label><textarea id="ik-relationships" rows="3" class="savable w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., My family, my role as a mentor..."></textarea></div>
                            <div><label for="ik-motivations" class="block text-lg font-semibold mb-2">What is a core motivation?</label><textarea id="ik-motivations" rows="3" class="savable w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., To reduce suffering..."></textarea></div>
                        </div>
                        <button id="ik-synthesize-btn" class="mt-6 bg-blue-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700">Synthesize My Kernel</button>
                        <div id="ik-result" class="mt-6"></div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">Unified Experience Vector (UEV)</h2></div>
                        <p class="mb-6 text-gray-600">Map your internal alignment on a specific issue. This assesses your "Present Integration" -- a key component of your ATCF.</p>
                        <div><label for="cps-situation" class="block text-lg font-semibold mb-2">Describe an ethical situation:</label><textarea id="cps-situation" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="e.g., My friend asked me to lie for them..."></textarea></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 mt-6">
                            <div><label for="cps-feeling" class="block text-lg font-semibold">Global Feeling Tone</label><input type="range" id="cps-feeling" min="-10" max="10" value="0" class="savable w-full"><div class="flex justify-between text-xs text-gray-500 mt-1"><span>Conflict</span><span>Neutral</span><span>Coherence</span></div></div>
                            <div><label for="cps-motivation" class="block text-lg font-semibold">Emotional Motivation Vector</label><input type="range" id="cps-motivation" min="-10" max="10" value="0" class="savable w-full"><div class="flex justify-between text-xs text-gray-500 mt-1"><span>Conflict</span><span>Neutral</span><span>Coherence</span></div></div>
                            <div><label for="cps-reasoning" class="block text-lg font-semibold">Rational Deliberation Vector</label><input type="range" id="cps-reasoning" min="-10" max="10" value="0" class="savable w-full"><div class="flex justify-between text-xs text-gray-500 mt-1"><span>Conflict</span><span>Neutral</span><span>Coherence</span></div></div>
                            <div><label for="cps-action" class="block text-lg font-semibold">Action Readiness Vector</label><input type="range" id="cps-action" min="-10" max="10" value="0" class="savable w-full"><div class="flex justify-between text-xs text-gray-500 mt-1"><span>Conflict</span><span>Neutral</span><span>Coherence</span></div></div>
                        </div>
                        <button id="cps-analyze-btn" class="mt-8 bg-green-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-green-700">Analyze My Present Integration</button>
                        <div id="cps-result" class="mt-6"></div>
                        <div id="cps-dialogue-container" class="mt-6 hidden">
                            <h4 class="text-lg font-semibold text-gray-700 mb-2">Conversational AI Coach</h4>
                            <div id="cps-chat-history" class="space-y-4 mb-4 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border flex flex-col"></div>
                            <div class="flex space-x-2"><input type="text" id="cps-chat-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Respond..."><button id="cps-chat-send-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700">Send</button></div>
                            <div id="cps-chat-loader" class="hidden"><div class="loader"></div></div>
                        </div>
                    </div>
                </div>

                <!-- View 3: BROA Filter Lab -->
                <div id="broa-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">BROA Filter Lab</h2></div>
                    <p class="mb-6 text-gray-600">Make your unconscious ethical filter visible.</p>
                    <div><label for="broa-situation" class="block text-lg font-semibold mb-2">The Ethical Situation:</label><textarea id="broa-situation" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Describe or load the demo..."></textarea></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-6">
                        <div><label for="broa-beliefs" class="block text-lg font-semibold mb-2">B: Beliefs</label><p class="text-sm text-gray-500 mb-2">What do you assume is true?</p><textarea id="broa-beliefs" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'True friendship means helping...'"></textarea></div>
                        <div><label for="broa-rules" class="block text-lg font-semibold mb-2">R: Rules</label><p class="text-sm text-gray-500 mb-2">What rules feel active?</p><textarea id="broa-rules" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'The rule is you don't cheat.'"></textarea></div>
                        <div><label for="broa-ontology" class="block text-lg font-semibold mb-2">O: Ontology</label><p class="text-sm text-gray-500 mb-2">What kind of thing *is* this?</p><textarea id="broa-ontology" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'This is a test of my character.'"></textarea></div>
                        <div><label for="broa-authenticity" class="block text-lg font-semibold mb-2">A: Authenticity</label><p class="text-sm text-gray-500 mb-2">What does your inner compass say?</p><textarea id="broa-authenticity" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'Helping them cheat feels wrong.'"></textarea></div>
                    </div>
                    <button id="broa-analyze-btn" class="mt-8 bg-purple-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-purple-700">Analyze My Filters</button>
                    <div id="broa-result" class="mt-6"></div>
                </div>

                <!-- View 4: ABCD Mindset Lab -->
                <div id="abcd-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                   <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">ABCD Mindset Practice</h2></div>
                    <p class="mb-6 text-gray-600">Train your ethical attention by seeing any situation through four lenses: Agency, Beauty/Awe, Context, and Dynamism.</p>
                    <div><label for="abcd-situation" class="block text-lg font-semibold mb-2">The Ethical Situation:</label><textarea id="abcd-situation" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Describe or load the demo..."></textarea></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-6">
                        <div><label for="abcd-agency" class="block text-lg font-semibold mb-2">A: Agency</label><p class="text-sm text-gray-500 mb-2">Who has power, voice, or the ability to act?</p><textarea id="abcd-agency" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'My friend has agency to ask...'"></textarea></div>
                        <div><label for="abcd-beauty" class="block text-lg font-semibold mb-2">B: Beauty / Awe</label><p class="text-sm text-gray-500 mb-2">What has intrinsic value here?</p><textarea id="abcd-beauty" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'The value of our friendship is beautiful...'"></textarea></div>
                        <div><label for="abcd-context" class="block text-lg font-semibold mb-2">C: Context</label><p class="text-sm text-gray-500 mb-2">What is the backstory?</p><textarea id="abcd-context" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'The context is my friend is under immense pressure...'"></textarea></div>
                        <div><label for="abcd-dynamism" class="block text-lg font-semibold mb-2">D: Dynamism</label><p class="text-sm text-gray-500 mb-2">How is this situation changing?</p><textarea id="abcd-dynamism" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., 'If I help them, the immediate situation is resolved, but...'"></textarea></div>
                    </div>
                    <button id="abcd-analyze-btn" class="mt-8 bg-teal-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-teal-700">Analyze My Perception</button>
                    <div id="abcd-result" class="mt-6"></div>
                </div>

                <!-- View 5: SAGE Design Lab -->
                <div id="sage-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">SAGE System Design Lab</h2></div>
                    <p class="mb-8 text-gray-600">Apply your ethical insights to a real-world problem using the SAGE methodology: See, Analyze, Generate, and Evaluate.</p>
                    <div class="space-y-8">
                        <div><h3 class="text-2xl font-semibold mb-2 text-blue-600">S: See the System</h3><p class="mb-3 text-gray-500">Define the problem or system you want to address.</p><textarea id="sage-see" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The system of academic pressure..."></textarea></div>
                        <div><h3 class="text-2xl font-semibold mb-2 text-red-600">A: Analyze the Root Causes</h3><p class="mb-3 text-gray-500">What are the underlying patterns, incentives, and feedback loops?</p><textarea id="sage-analyze" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The root causes include a competitive culture..."></textarea></div>
                        <div><h3 class="text-2xl font-semibold mb-2 text-green-600">G: Generate Ethical Solutions</h3><p class="mb-3 text-gray-500">Brainstorm potential interventions or redesigns.</p><textarea id="sage-generate" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., We could create a peer tutoring network..."></textarea><button id="sage-brainstorm-btn" class="mt-3 bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700">AI Brainstorm Help</button></div>
                        <div><h3 class="text-2xl font-semibold mb-2 text-purple-600">E: Evaluate the Possibilities</h3><p class="mb-3 text-gray-500">Consider the potential impacts, risks, and ethical trade-offs.</p><textarea id="sage-evaluate" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., A peer tutoring network has low risk..."></textarea></div>
                    </div>
                    <div id="sage-result" class="mt-8"></div>
                </div>

                <!-- View 6: Ethical Lens Navigator -->
                <div id="lens-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">Ethical Lens Navigator</h2></div>
                    <p class="mb-6 text-gray-600">Analyze your dilemma through four classical ethical frameworks to gain a multi-perspectival view and find a coherent path forward.</p>
                    <div><label for="lens-situation" class="block text-lg font-semibold mb-2">The Ethical Situation:</label><textarea id="lens-situation" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Describe or load the demo..."></textarea></div>
                    <button id="lens-analyze-btn" class="mt-8 bg-orange-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-orange-700">Analyze with Lenses</button>
                    <div id="lens-result" class="mt-8"></div>
                </div>
                
                <!-- View 7: Justice System Cartography Lab -->
                <div id="justice-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">Justice System Cartography Lab</h2></div>
                    <p class="mb-6 text-gray-600">Map the architecture of fairness in a complex system.</p>
                    
                    <div class="border-b-2 border-gray-200 pb-8 mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Part 1: Initial System Map</h3>
                        <div class="border-b pb-8 mb-8"><label for="justice-case-study" class="block text-lg font-semibold mb-2">Justice Case Study:</label><textarea id="justice-case-study" rows="6" class="savable w-full p-3 border border-gray-300 rounded-lg bg-gray-50" placeholder="Click 'Generate Case Study' or paste your own here."></textarea><button id="justice-generate-case-btn" class="mt-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Generate Case Study</button></div>
                        <div class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">1. Map the Architecture of Fairness</h3><p class="mb-3 text-gray-500">Who are the stakeholders? What are the power dynamics and feedback loops?</p><textarea id="justice-map" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., Stakeholders include students, faculty..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">2. Identify the Types of Justice</h3><p class="mb-3 text-gray-500">Which forms of justice are present or absent?</p><textarea id="justice-types" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The school's process focuses on Retributive Justice..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">3. Design a Constructive Intervention</h3><p class="mb-3 text-gray-500">Propose a change to make the system more just.</p><textarea id="justice-intervention" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., I propose a restorative justice circle..."></textarea></div>
                        </div>
                        <button id="justice-analyze-btn" class="mt-8 bg-red-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-red-700">Analyze My Justice Map</button>
                        <div id="justice-result" class="mt-8"></div>
                    </div>
                    
                    <div id="justice-synergy-container" class="synergy-lab-locked">
                        <h3 class="text-2xl font-bold text-indigo-600 mb-4">Part 2: Cross-Scale Coordination & Synergy Lab</h3>
                        <p class="mb-6 text-gray-500">This advanced lab is now unlocked. Deepen your analysis to refine your intervention into a robust moral innovation by ensuring it coordinates effectively across different scales and perspectives.</p>
                        <div id="justice-synergy-lab" class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">1. Identify Primary Scale & Lenses</h3><p class="mb-3 text-gray-500">At what level of social organization is your intervention primarily aimed (e.g., Individual, Community, Institutional)? Based on Scale-Appropriate Ethics, which ethical frameworks are most effective at that scale?</p><textarea id="justice-synergy-scale" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">2. Map Cross-Scale Conflicts</h3><p class="mb-3 text-gray-500">How might your solution, which is designed for one scale, create unintended problems or tensions at a different scale (e.g., how might a new Institutional rule affect Individual relationships)?</p><textarea id="justice-synergy-conflicts" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">3. Reframe as a Capability Proposition</h3><p class="mb-3 text-gray-500">Instead of describing what your intervention *does*, describe what it makes *possible*. What new capabilities for action, feeling, or reasoning does it give to the people involved?</p><textarea id="justice-synergy-capability" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">4. Test for Functional Equivalence (FEF)</h3><p class="mb-3 text-gray-500">Your intervention is likely based on a moral argument. Now, make the strongest possible case for the *exact same intervention* from a completely different, non-moral perspective (e.g., pure economic efficiency, risk management, or brand reputation).</p><textarea id="justice-synergy-fef" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                        </div>
                        <button id="justice-synergy-analyze-btn" class="mt-8 bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700">Run Synergy Analysis</button>
                    </div>

                    <div id="justice-dialogue-container" class="mt-6 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Conversational AI Coach</h4>
                        <div id="justice-chat-history" class="space-y-4 mb-4 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border flex flex-col"></div>
                        <div class="flex space-x-2"><input type="text" id="justice-chat-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Continue the analysis..."><button id="justice-chat-send-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700">Send</button></div>
                        <div id="justice-chat-loader" class="hidden"><div class="loader"></div></div>
                    </div>
                </div>

                <!-- View 8: Technology System Cartography Lab -->
                <div id="tech-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">Technology System Cartography Lab</h2></div>
                    <p class="mb-6 text-gray-600">Map the ethical architecture of a sociotechnical system.</p>
                    <div class="border-b-2 border-gray-200 pb-8 mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Part 1: Initial System Map</h3>
                        <div class="border-b pb-8 mb-8"><label for="tech-case-study" class="block text-lg font-semibold mb-2">Technology Case Study:</label><textarea id="tech-case-study" rows="6" class="savable w-full p-3 border border-gray-300 rounded-lg bg-gray-50" placeholder="Click 'Generate Case Study' or paste your own here."></textarea><button id="tech-generate-case-btn" class="mt-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Generate Case Study</button></div>
                        <div class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">1. Map the Sociotechnical System</h3><p class="mb-3 text-gray-500">Who are the users, designers, and non-users? What are the system's goals and feedback loops?</p><textarea id="tech-map" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The system is a social media algorithm..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">2. Identify Embedded Values & CPS Impact</h3><p class="mb-3 text-gray-500">What values are encoded in the design? How does it affect the user's identity and coherence?</p><textarea id="tech-values" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The algorithm values engagement over truth..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">3. Design a Constructive Intervention</h3><p class="mb-3 text-gray-500">Propose a redesign, a policy change, or a new norm to make the system more ethical.</p><textarea id="tech-intervention" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., I propose a 'mindful mode' that limits infinite scroll..."></textarea></div>
                        </div>
                        <button id="tech-analyze-btn" class="mt-8 bg-cyan-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-cyan-700">Analyze My Tech Map</button>
                        <div id="tech-result" class="mt-8"></div>
                    </div>
                    
                    <div id="tech-synergy-container" class="synergy-lab-locked">
                        <h3 class="text-2xl font-bold text-indigo-600 mb-4">Part 2: Cross-Scale Coordination & Synergy Lab</h3>
                        <p class="mb-6 text-gray-500">This advanced lab is now unlocked. Deepen your analysis to refine your intervention into a robust moral innovation by ensuring it coordinates effectively across different scales and perspectives.</p>
                        <div id="tech-synergy-lab" class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">1. Identify Primary Scale & Lenses</h3><p class="mb-3 text-gray-500">At what level of social organization is your intervention primarily aimed (e.g., Individual, Community, Institutional)? Based on Scale-Appropriate Ethics, which ethical frameworks are most effective at that scale?</p><textarea id="tech-synergy-scale" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">2. Map Cross-Scale Conflicts</h3><p class="mb-3 text-gray-500">How might your solution, which is designed for one scale, create unintended problems or tensions at a different scale (e.g., how might a new Institutional rule affect Individual relationships)?</p><textarea id="tech-synergy-conflicts" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">3. Reframe as a Capability Proposition</h3><p class="mb-3 text-gray-500">Instead of describing what your intervention *does*, describe what it makes *possible*. What new capabilities for action, feeling, or reasoning does it give to the people involved?</p><textarea id="tech-synergy-capability" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">4. Test for Functional Equivalence (FEF)</h3><p class="mb-3 text-gray-500">Your intervention is likely based on a moral argument. Now, make the strongest possible case for the *exact same intervention* from a completely different, non-moral perspective (e.g., pure economic efficiency, risk management, or brand reputation).</p><textarea id="tech-synergy-fef" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                        </div>
                        <button id="tech-synergy-analyze-btn" class="mt-8 bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700">Run Synergy Analysis</button>
                    </div>

                    <div id="tech-dialogue-container" class="mt-6 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Conversational AI Coach</h4>
                        <div id="tech-chat-history" class="space-y-4 mb-4 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border flex flex-col"></div>
                        <div class="flex space-x-2"><input type="text" id="tech-chat-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Continue the analysis..."><button id="tech-chat-send-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700">Send</button></div>
                        <div id="tech-chat-loader" class="hidden"><div class="loader"></div></div>
                    </div>
                </div>

                 <!-- View 9: Environmental System Cartography Lab -->
                <div id="env-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">Environmental System Cartography Lab</h2></div>
                    <p class="mb-6 text-gray-600">Map the ethical architecture of a complex ecological system.</p>
                    
                    <div class="border-b-2 border-gray-200 pb-8 mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Part 1: Initial System Map</h3>
                        <div class="border-b pb-8 mb-8"><label for="env-case-study" class="block text-lg font-semibold mb-2">Environmental Case Study:</label><textarea id="env-case-study" rows="6" class="savable w-full p-3 border border-gray-300 rounded-lg bg-gray-50" placeholder="Click 'Generate Case Study' or paste your own here."></textarea><button id="env-generate-case-btn" class="mt-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Generate Case Study</button></div>
                        <div class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">1. Map the Ecological System</h3><p class="mb-3 text-gray-500">Who are the human and non-human stakeholders? What are the key feedback loops and planetary boundaries?</p><textarea id="env-map" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., Stakeholders include students, the university, local wildlife, and downstream communities..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">2. Identify the Core Ethical Tensions</h3><p class="mb-3 text-gray-500">What values are in conflict (e.g., economic development vs. biodiversity, present needs vs. future generations)?</p><textarea id="env-tensions" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The university's need for expansion conflicts with the preservation of a local wetland..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">3. Design a Constructive Intervention</h3><p class="mb-3 text-gray-500">Propose a change to create a more resilient and just socio-ecological system.</p><textarea id="env-intervention" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., I propose a 'living building' design for the new wellness center that incorporates green roofs..."></textarea></div>
                        </div>
                        <button id="env-analyze-btn" class="mt-8 bg-green-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-green-800">Analyze My Eco-Map</button>
                        <div id="env-result" class="mt-8"></div>
                    </div>
                    
                    <div id="env-synergy-container" class="synergy-lab-locked">
                        <h3 class="text-2xl font-bold text-indigo-600 mb-4">Part 2: Cross-Scale Coordination & Synergy Lab</h3>
                        <p class="mb-6 text-gray-500">This advanced lab is now unlocked. Deepen your analysis to refine your intervention into a robust moral innovation by ensuring it coordinates effectively across different scales and perspectives.</p>
                        <div id="env-synergy-lab" class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">1. Identify Primary Scale & Lenses</h3><p class="mb-3 text-gray-500">At what level of social organization is your intervention primarily aimed (e.g., Individual, Community, Institutional)? Based on Scale-Appropriate Ethics, which ethical frameworks are most effective at that scale?</p><textarea id="env-synergy-scale" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">2. Map Cross-Scale Conflicts</h3><p class="mb-3 text-gray-500">How might your solution, which is designed for one scale, create unintended problems or tensions at a different scale (e.g., how might a new Institutional rule affect Individual relationships)?</p><textarea id="env-synergy-conflicts" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">3. Reframe as a Capability Proposition</h3><p class="mb-3 text-gray-500">Instead of describing what your intervention *does*, describe what it makes *possible*. What new capabilities for action, feeling, or reasoning does it give to the people involved?</p><textarea id="env-synergy-capability" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">4. Test for Functional Equivalence (FEF)</h3><p class="mb-3 text-gray-500">Your intervention is likely based on a moral argument. Now, make the strongest possible case for the *exact same intervention* from a completely different, non-moral perspective (e.g., pure economic efficiency, risk management, or brand reputation).</p><textarea id="env-synergy-fef" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                        </div>
                        <button id="env-synergy-analyze-btn" class="mt-8 bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700">Run Synergy Analysis</button>
                    </div>

                    <div id="env-dialogue-container" class="mt-6 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Conversational AI Coach</h4>
                        <div id="env-chat-history" class="space-y-4 mb-4 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border flex flex-col"></div>
                        <div class="flex space-x-2"><input type="text" id="env-chat-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Continue the analysis..."><button id="env-chat-send-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700">Send</button></div>
                        <div id="env-chat-loader" class="hidden"><div class="loader"></div></div>
                    </div>
                </div>

                 <!-- View 10: Healthcare System Cartography Lab -->
                <div id="health-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">Healthcare System Cartography Lab</h2></div>
                    <p class="mb-6 text-gray-600">Map the ethical architecture of a complex healthcare system.</p>
                    
                    <div class="border-b-2 border-gray-200 pb-8 mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Part 1: Initial System Map</h3>
                        <div class="border-b pb-8 mb-8"><label for="health-case-study" class="block text-lg font-semibold mb-2">Healthcare Case Study:</label><textarea id="health-case-study" rows="6" class="savable w-full p-3 border border-gray-300 rounded-lg bg-gray-50" placeholder="Click 'Generate Case Study' or paste your own here."></textarea><button id="health-generate-case-btn" class="mt-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Generate Case Study</button></div>
                        <div class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">1. Map the Healthcare System</h3><p class="mb-3 text-gray-500">Who are the stakeholders (patients, clinicians, insurers, etc.)? What are the key feedback loops (e.g., treatment outcomes, costs, access)?</p><textarea id="health-map" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., Stakeholders include the patient, their family, the clinical team..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">2. Identify the Core Ethical Tensions</h3><p class="mb-3 text-gray-500">What values are in conflict (e.g., patient autonomy vs. clinical judgment, cost containment vs. quality of care)?</p><textarea id="health-tensions" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The core tension is between the patient's right to refuse treatment..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">3. Design a Constructive Intervention</h3><p class="mb-3 text-gray-500">Propose a change to create a more ethical and resilient healthcare system or process.</p><textarea id="health-intervention" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., I propose implementing a mandatory ethics consultation..."></textarea></div>
                        </div>
                        <button id="health-analyze-btn" class="mt-8 bg-pink-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-pink-700">Analyze My Healthcare Map</button>
                        <div id="health-result" class="mt-8"></div>
                    </div>
                    
                    <div id="health-synergy-container" class="synergy-lab-locked">
                        <h3 class="text-2xl font-bold text-indigo-600 mb-4">Part 2: Cross-Scale Coordination & Synergy Lab</h3>
                        <p class="mb-6 text-gray-500">This advanced lab is now unlocked. Deepen your analysis to refine your intervention into a robust moral innovation by ensuring it coordinates effectively across different scales and perspectives.</p>
                        <div id="health-synergy-lab" class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">1. Identify Primary Scale & Lenses</h3><p class="mb-3 text-gray-500">At what level of social organization is your intervention primarily aimed? Based on Scale-Appropriate Ethics, which ethical frameworks are most effective at that scale?</p><textarea id="health-synergy-scale" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">2. Map Cross-Scale Conflicts</h3><p class="mb-3 text-gray-500">How might your solution create tension with the needs or norms of a different scale?</p><textarea id="health-synergy-conflicts" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">3. Reframe as a Capability Proposition</h3><p class="mb-3 text-gray-500">What new capabilities for action, feeling, or reasoning does your intervention make possible for the agents involved?</p><textarea id="health-synergy-capability" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">4. Test for Functional Equivalence (FEF)</h3><p class="mb-3 text-gray-500">Make a case for your intervention from a completely different moral or pragmatic standpoint.</p><textarea id="health-synergy-fef" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                        </div>
                        <button id="health-synergy-analyze-btn" class="mt-8 bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700">Run Synergy Analysis</button>
                    </div>

                    <div id="health-dialogue-container" class="mt-6 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Conversational AI Coach</h4>
                        <div id="health-chat-history" class="space-y-4 mb-4 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border flex flex-col"></div>
                        <div class="flex space-x-2"><input type="text" id="health-chat-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Continue the analysis..."><button id="health-chat-send-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700">Send</button></div>
                        <div id="health-chat-loader" class="hidden"><div class="loader"></div></div>
                    </div>
                </div>
                
                 <!-- View 11: Education System Cartography Lab -->
                <div id="education-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">Education System Cartography Lab</h2></div>
                    <p class="mb-6 text-gray-600">Map the ethical architecture of a complex educational system.</p>
                    
                    <div class="border-b-2 border-gray-200 pb-8 mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Part 1: Initial System Map</h3>
                        <div class="border-b pb-8 mb-8"><label for="education-case-study" class="block text-lg font-semibold mb-2">Education Case Study:</label><textarea id="education-case-study" rows="6" class="savable w-full p-3 border border-gray-300 rounded-lg bg-gray-50" placeholder="Click 'Generate Case Study' or paste your own here."></textarea><button id="education-generate-case-btn" class="mt-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Generate Case Study</button></div>
                        <div class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">1. Map the Educational System</h3><p class="mb-3 text-gray-500">Who are the stakeholders (students, teachers, administrators, parents, community)? What are the key feedback loops (e.g., funding, test scores, student well-being)?</p><textarea id="education-map" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., Stakeholders include students with diverse learning needs, teachers facing burnout, and administrators balancing budgets..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">2. Identify the Core Ethical Tensions</h3><p class="mb-3 text-gray-500">What values are in conflict (e.g., standardized excellence vs. individualized growth, safety vs. autonomy, equity vs. local control)?</p><textarea id="education-tensions" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The tension is between a standardized curriculum designed for equity and the need for teachers to have the autonomy to meet individual student needs..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">3. Design a Constructive Intervention</h3><p class="mb-3 text-gray-500">Propose a change to create a more ethical and resilient educational system or practice.</p><textarea id="education-intervention" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., I propose a 'portfolio-based assessment' model that allows students to demonstrate mastery in multiple ways..."></textarea></div>
                        </div>
                        <button id="education-analyze-btn" class="mt-8 bg-yellow-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-yellow-700">Analyze My Education Map</button>
                        <div id="education-result" class="mt-8"></div>
                    </div>
                    
                    <div id="education-synergy-container" class="synergy-lab-locked">
                        <h3 class="text-2xl font-bold text-indigo-600 mb-4">Part 2: Cross-Scale Coordination & Synergy Lab</h3>
                        <p class="mb-6 text-gray-500">This advanced lab is now unlocked. Deepen your analysis to refine your intervention into a robust moral innovation by ensuring it coordinates effectively across different scales and perspectives.</p>
                        <div id="education-synergy-lab" class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">1. Identify Primary Scale & Lenses</h3><p class="mb-3 text-gray-500">At what level of social organization is your intervention primarily aimed? Based on Scale-Appropriate Ethics, which ethical frameworks are most effective at that scale?</p><textarea id="education-synergy-scale" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">2. Map Cross-Scale Conflicts</h3><p class="mb-3 text-gray-500">How might your solution create tension with the needs or norms of a different scale?</p><textarea id="education-synergy-conflicts" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">3. Reframe as a Capability Proposition</h3><p class="mb-3 text-gray-500">What new capabilities for action, feeling, or reasoning does your intervention make possible for the agents involved?</p><textarea id="education-synergy-capability" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">4. Test for Functional Equivalence (FEF)</h3><p class="mb-3 text-gray-500">Make a case for your intervention from a completely different moral or pragmatic standpoint.</p><textarea id="education-synergy-fef" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                        </div>
                        <button id="education-synergy-analyze-btn" class="mt-8 bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700">Run Synergy Analysis</button>
                    </div>

                    <div id="education-dialogue-container" class="mt-6 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Conversational AI Coach</h4>
                        <div id="education-chat-history" class="space-y-4 mb-4 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border flex flex-col"></div>
                        <div class="flex space-x-2"><input type="text" id="education-chat-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Continue the analysis..."><button id="education-chat-send-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700">Send</button></div>
                        <div id="education-chat-loader" class="hidden"><div class="loader"></div></div>
                    </div>
                </div>

                <!-- View 12: Politics System Cartography Lab -->
                <div id="politics-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">Political System Cartography Lab</h2></div>
                    <p class="mb-6 text-gray-600">Map the ethical architecture of a complex political system.</p>
                    
                    <div class="border-b-2 border-gray-200 pb-8 mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Part 1: Initial System Map</h3>
                        <div class="border-b pb-8 mb-8"><label for="politics-case-study" class="block text-lg font-semibold mb-2">Political Case Study:</label><textarea id="politics-case-study" rows="6" class="savable w-full p-3 border border-gray-300 rounded-lg bg-gray-50" placeholder="Click 'Generate Case Study' or paste your own here."></textarea><button id="politics-generate-case-btn" class="mt-4 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700">Generate Case Study</button></div>
                        <div class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">1. Map the Political System</h3><p class="mb-3 text-gray-500">Who are the stakeholders (citizens, parties, institutions, media)? What are the key feedback loops (e.g., elections, public opinion, policy outcomes)?</p><textarea id="politics-map" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., Stakeholders include student government, the university administration, and various student activist groups..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">2. Identify the Core Ethical Tensions</h3><p class="mb-3 text-gray-500">What values are in conflict (e.g., individual liberty vs. collective security, free speech vs. public safety, national interest vs. global responsibility)?</p><textarea id="politics-tensions" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., The core tension is between the right to free speech on campus and the need to maintain a safe and inclusive learning environment for all students..."></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-gray-700">3. Design a Constructive Intervention</h3><p class="mb-3 text-gray-500">Propose a policy, a new form of dialogue, or a structural change to create a more ethical and resilient political process.</p><textarea id="politics-intervention" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., I propose a 'Campus Dialogue Initiative' that uses trained moderators to facilitate conversations between groups with opposing views..."></textarea></div>
                        </div>
                        <button id="politics-analyze-btn" class="mt-8 bg-gray-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-gray-800">Analyze My Political Map</button>
                        <div id="politics-result" class="mt-8"></div>
                    </div>
                    
                    <div id="politics-synergy-container" class="synergy-lab-locked">
                        <h3 class="text-2xl font-bold text-indigo-600 mb-4">Part 2: Cross-Scale Coordination & Synergy Lab</h3>
                        <p class="mb-6 text-gray-500">This advanced lab is now unlocked. Deepen your analysis to refine your intervention into a robust moral innovation by ensuring it coordinates effectively across different scales and perspectives.</p>
                        <div id="politics-synergy-lab" class="space-y-8">
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">1. Identify Primary Scale & Lenses</h3><p class="mb-3 text-gray-500">At what level of social organization is your intervention primarily aimed? Based on Scale-Appropriate Ethics, which ethical frameworks are most effective at that scale?</p><textarea id="politics-synergy-scale" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">2. Map Cross-Scale Conflicts</h3><p class="mb-3 text-gray-500">How might your solution create tension with the needs or norms of a different scale?</p><textarea id="politics-synergy-conflicts" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">3. Reframe as a Capability Proposition</h3><p class="mb-3 text-gray-500">What new capabilities for action, feeling, or reasoning does your intervention make possible for the agents involved?</p><textarea id="politics-synergy-capability" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                            <div><h3 class="text-xl font-semibold mb-2 text-indigo-700">4. Test for Functional Equivalence (FEF)</h3><p class="mb-3 text-gray-500">Make a case for your intervention from a completely different moral or pragmatic standpoint.</p><textarea id="politics-synergy-fef" rows="4" class="savable w-full p-3 border border-gray-300 rounded-lg"></textarea></div>
                        </div>
                        <button id="politics-synergy-analyze-btn" class="mt-8 bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-indigo-700">Run Synergy Analysis</button>
                    </div>

                    <div id="politics-dialogue-container" class="mt-6 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Conversational AI Coach</h4>
                        <div id="politics-chat-history" class="space-y-4 mb-4 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border flex flex-col"></div>
                        <div class="flex space-x-2"><input type="text" id="politics-chat-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Continue the analysis..."><button id="politics-chat-send-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700">Send</button></div>
                        <div id="politics-chat-loader" class="hidden"><div class="loader"></div></div>
                    </div>
                </div>

                <!-- View 13: Legacy Project -->
                <div id="legacy-lab-view" class="view bg-white p-6 md:p-8 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-2"><h2 class="text-3xl font-bold">The Legacy Project</h2></div>
                    <p class="mb-8 text-gray-600">This is your capstone project. Synthesize your work from across the dashboard to define your moral innovation and formulate your legacy as a constructor with a high **Meta-Constructor Capacity**.</p>
                    
                    <div class="space-y-8">
                        <div><h3 class="text-2xl font-semibold mb-2 text-gray-700">1. My Moral Innovation</h3><p class="mb-3 text-gray-500">Clearly articulate the systemic intervention you designed in the SAGE, Justice, Technology, or Environmental labs. What is the core idea?</p><textarea id="legacy-innovation" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., My moral innovation is a 'structured choice' model for first-year grading that balances student well-being and academic rigor..."></textarea></div>
                        
                        <div><h3 class="text-2xl font-semibold mb-2 text-gray-700">2. Synthesize Key Insights</h3><p class="mb-3 text-gray-500">Connect your innovation back to your foundational work. How does it reflect your Identity Kernel? How is it informed by your BROA, ABCD, and Lens analyses?</p><textarea id="legacy-insights" rows="6" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., This innovation reflects my core value of compassion and my motivation to reduce systemic stress. My BROA analysis revealed my bias toward individual achievement, which this model corrects for..."></textarea></div>
                        
                        <div><h3 class="text-2xl font-semibold mb-2 text-gray-700">3. My Legacy Statement</h3><p class="mb-3 text-gray-500">Based on your work, formulate a legacy statement. How do you intend to act as a **meta-constructor** in the world? What new capabilities for coherence and coordination do you hope to build, first in yourself, and then for others?</p><textarea id="legacy-statement" rows="5" class="savable w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g., My legacy is to be a constructor who designs systems that are not only fair but also compassionate, creating the capability for others to learn and grow without sacrificing their well-being..."></textarea></div>
                    </div>
                    <button id="legacy-analyze-btn" class="mt-8 bg-purple-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-purple-800">Receive Capstone Feedback</button>
                    <div id="legacy-result" class="mt-8"></div>
                    <div id="legacy-dialogue-container" class="mt-6 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Conversational AI Coach</h4>
                        <div id="legacy-chat-history" class="space-y-4 mb-4 max-h-96 overflow-y-auto p-4 bg-gray-50 rounded-lg border flex flex-col"></div>
                        <div class="flex space-x-2"><input type="text" id="legacy-chat-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Continue the analysis..."><button id="legacy-chat-send-btn" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700">Send</button></div>
                        <div id="legacy-chat-loader" class="hidden"><div class="loader"></div></div>
                    </div>
                </div>

            </div>
        </main>
    </div>
    
    <!-- Modal Structures -->
    <div id="start-here-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="start-here-modal-title">
        <div class="modal-content">
            <button id="start-here-modal-close-btn" class="modal-close-btn" aria-label="Close modal">&times;</button>
            <div class="modal-body">
                <h2 id="start-here-modal-title" class="text-2xl font-bold mb-4">Your Privacy & Psychological Safety</h2>
                <div class="space-y-4 text-gray-700">
                    <p>This tool is designed for deep, personal reflection. Before you begin, please understand how your data is handled.</p>
                    <div>
                        <h3 class="font-semibold text-gray-900">1. How the Dashboard Saves Your Work</h3>
                        <p>All the text you enter into the fields of this dashboard is saved <strong>directly in your browser's local storage</strong>. It is not sent to any server, and it is not visible to anyone else, including the creators of this tool. To resume your work, you must use the same computer and browser.</p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900">2. How the AI Analysis Works</h3>
                        <p>When you click an "Analyze" or "Synthesize" button, the text from the relevant fields is sent to Google's servers to be processed by a large language model. This is done using a secure, encrypted HTTPS connection to protect your privacy during transmission. <strong>This interaction is stateless; your data is not stored or used to train the model.</strong> However, like any online transmission, it involves sending your text over the internet.</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800">3. Activating AI Features (One-Time Setup)</h3>
                        <p class="text-blue-700">To enable the AI analysis features on a public site like GitHub, you need a free API key from Google AI Studio. This is a one-time setup.</p>
                        <ol class="list-decimal list-inside pl-4 space-y-1 mt-2 text-sm">
                            <li>Go to <a href="https://aistudio.google.com" target="_blank" class="underline">aistudio.google.com</a> and sign in.</li>
                            <li>Click "Get API key," then "Create API key in new project."</li>
                            <li>Copy the generated key.</li>
                            <li>Paste the key into the input box below and click "Save Key". You only need to do this once per browser.</li>
                        </ol>
                        <div class="mt-4 flex space-x-2">
                            <input type="text" id="api-key-input" class="flex-grow p-2 border border-gray-300 rounded-lg" placeholder="Paste your API key here">
                            <button id="save-api-key-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-blue-700">Save Key</button>
                        </div>
                        <p id="api-key-status" class="text-xs text-gray-500 mt-1"></p>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-900">4. Advice for Your Psychological Safety</h3>
                        <p>This is a space for you to explore your own thoughts and feelings. To ensure you feel safe and in control:</p>
                        <ul class="list-disc list-inside pl-4 space-y-1 mt-2">
                            <li><strong>Be Mindful:</strong> You are in complete control of what you write. Only share what feels right to you.</li>
                            <li><strong>Generalize If Needed:</strong> If you are reflecting on sensitive personal experiences, consider describing them in general terms rather than with specific, identifying details.</li>
                            <li><strong>Protect Others' Privacy:</strong> Avoid using the real names or identifying information of other people in your reflections without their explicit permission.</li>
                        </ul>
                    </div>
                    <p class="pt-4 text-sm text-gray-600">By using this tool, you acknowledge this process. We hope it provides a valuable space for your growth and self-discovery.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="abcd-mindset-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="abcd-mindset-modal-title">
        <div class="modal-content">
            <button id="abcd-mindset-modal-close-btn" class="modal-close-btn" aria-label="Close modal">&times;</button>
            <div class="modal-body">
                <h2 id="abcd-mindset-modal-title" class="text-2xl font-bold mb-4">The ABCD Constructor's Mindset</h2>
                <div class="space-y-4 text-gray-700">
                    <p>Each day, ground yourself in the constructor's point of view. This is a practical mindset for building a more coherent self and coordinating effectively with others. Today's focus is:</p>
                    <div id="abcd-prompts-container" class="space-y-3 mt-4"></div>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_KEY_STORAGE = 'geminiApiKey';
            const STORAGE_KEY = 'constructorDashboardData';
            
            let chatHistory = [];
            let activeChat = null;
            let isDemoMode = false;

            const allSavableFields = document.querySelectorAll('.savable');
            const actionButtons = document.getElementById('action-buttons');

            // --- Modal Logic ---
            const startHereBtn = document.getElementById('start-here-btn');
            const startHereModal = document.getElementById('start-here-modal');
            const startHereCloseBtn = document.getElementById('start-here-modal-close-btn');

            const abcdMindsetBtn = document.getElementById('abcd-mindset-btn');
            const abcdMindsetModal = document.getElementById('abcd-mindset-modal');
            const abcdMindsetCloseBtn = document.getElementById('abcd-mindset-modal-close-btn');

            const openModal = (modal) => modal.classList.remove('hidden');
            const closeModal = (modal) => modal.classList.add('hidden');

            startHereBtn.addEventListener('click', () => openModal(startHereModal));
            startHereCloseBtn.addEventListener('click', () => closeModal(startHereModal));
            startHereModal.addEventListener('click', (e) => { if (e.target === startHereModal) closeModal(startHereModal); });

            abcdMindsetBtn.addEventListener('click', () => {
                populateAbcdPrompts();
                openModal(abcdMindsetModal);
            });
            abcdMindsetCloseBtn.addEventListener('click', () => closeModal(abcdMindsetModal));
            abcdMindsetModal.addEventListener('click', (e) => { if (e.target === abcdMindsetModal) closeModal(abcdMindsetModal); });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (!startHereModal.classList.contains('hidden')) closeModal(startHereModal);
                    if (!abcdMindsetModal.classList.contains('hidden')) closeModal(abcdMindsetModal);
                }
            });
            
            // --- API Key Management ---
            const apiKeyInput = document.getElementById('api-key-input');
            const saveApiKeyBtn = document.getElementById('save-api-key-btn');
            const apiKeyStatus = document.getElementById('api-key-status');

            function getApiKey() {
                return localStorage.getItem(API_KEY_STORAGE) || "";
            }

            function updateApiKeyStatus() {
                const key = getApiKey();
                if (key) {
                    apiKeyStatus.textContent = `Key saved, ending in ...${key.slice(-4)}`;
                    apiKeyStatus.classList.remove('text-red-500');
                    apiKeyStatus.classList.add('text-green-600');
                    apiKeyInput.value = "";
                } else {
                    apiKeyStatus.textContent = 'No API Key saved. AI features will not work.';
                    apiKeyStatus.classList.remove('text-green-600');
                    apiKeyStatus.classList.add('text-red-500');
                }
            }

            saveApiKeyBtn.addEventListener('click', () => {
                const key = apiKeyInput.value.trim();
                if (key) {
                    localStorage.setItem(API_KEY_STORAGE, key);
                    updateApiKeyStatus();
                }
            });


            // --- ABCD Mindset Daily Prompts ---
            function populateAbcdPrompts() {
                const prompts = {
                    agency: [
                        "What choice today will strengthen my Identity Kernel?",
                        "Where can I act as a coordinator to bring two conflicting parts of my life into better alignment?",
                        "What system can I build or improve today, no matter how small?",
                        "How can I exercise my agency to create a new capability for myself or someone else?",
                        "What is one action I can take to move from my current self to my future-projected self?"
                    ],
                    beauty: [
                        "What elegant solution or coherent system can I appreciate today?",
                        "Where can I find beauty in the coordination between different people or ideas?",
                        "What moment of 'flow' or deep integration can I seek out today?",
                        "How does appreciating a complex, beautiful system (in nature, art, or science) inform my own work as a constructor?",
                        "What is one example of profound coherence I can find in the world today?"
                    ],
                    context: [
                        "Whose Personal Reality Framework (PRF) can I try to understand today to broaden my own?",
                        "What is the 'assembly history' of a situation I'm facing?",
                        "How can I find 'functional equivalence' between my perspective and someone else's, even if our beliefs differ?",
                        "What unseen feedback loop is shaping a challenge I'm currently facing?",
                        "How can I see a disagreement not as a conflict of values, but as a mismatch of contexts?"
                    ],
                    dynamism: [
                        "What belief in my PRF is ready for an update?",
                        "How can I embrace a small change today as a path to greater temporal coherence?",
                        "What is one way my identity is currently evolving, and how can I support that growth?",
                        "How can I see a moment of uncertainty not as a threat, but as an opportunity to reconstruct?",
                        "What is a 'productive tension' in my life right now that is driving my evolution as a constructor?"
                    ]
                };

                const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                
                const container = document.getElementById('abcd-prompts-container');
                container.innerHTML = `
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="font-semibold text-gray-900">Agency:</h3>
                        <p>${prompts.agency[dayOfYear % prompts.agency.length]}</p>
                    </div>
                    <div class="border-l-4 border-red-500 pl-4">
                        <h3 class="font-semibold text-gray-900">Beauty/Awe:</h3>
                        <p>${prompts.beauty[dayOfYear % prompts.beauty.length]}</p>
                    </div>
                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="font-semibold text-gray-900">Context:</h3>
                        <p>${prompts.context[dayOfYear % prompts.context.length]}</p>
                    </div>
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="font-semibold text-gray-900">Dynamism:</h3>
                        <p>${prompts.dynamism[dayOfYear % prompts.dynamism.length]}</p>
                    </div>
                `;
            }


            // --- Save & Load Logic ---
            function saveWork() {
                if (isDemoMode) return;
                const data = {};
                allSavableFields.forEach(field => {
                    data[field.id] = field.value;
                });
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            }

            function loadWork() {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    allSavableFields.forEach(field => {
                        if (data[field.id] !== undefined) {
                            field.value = data[field.id];
                        }
                    });
                }
            }

            function clearWork() {
                if (confirm("Are you sure you want to clear all your saved work? This cannot be undone.")) {
                    localStorage.removeItem(STORAGE_KEY);
                    allSavableFields.forEach(field => {
                        if (field.type === 'range') {
                            field.value = 0;
                        } else {
                            field.value = '';
                        }
                    });
                    ['prf-result', 'ik-result', 'cps-result', 'broa-result', 'abcd-result', 'sage-result', 'lens-result', 'justice-result', 'tech-result', 'env-result', 'health-result', 'education-result', 'politics-result', 'legacy-result'].forEach(id => { if(document.getElementById(id)) document.getElementById(id).innerHTML = ''; });
                    ['cps-dialogue-container', 'justice-dialogue-container', 'tech-dialogue-container', 'env-dialogue-container', 'health-dialogue-container', 'education-dialogue-container', 'politics-dialogue-container', 'legacy-dialogue-container'].forEach(id => { if(document.getElementById(id)) document.getElementById(id).classList.add('hidden'); });
                    ['justice-synergy-container', 'tech-synergy-container', 'env-synergy-container', 'health-synergy-container', 'education-synergy-container', 'politics-synergy-container'].forEach(id => { if(document.getElementById(id)) document.getElementById(id).classList.add('synergy-lab-locked'); });
                }
            }

            allSavableFields.forEach(field => {
                field.addEventListener('input', saveWork);
            });
            
            document.getElementById('clear-work-btn').addEventListener('click', clearWork);

            const tabButtons = document.querySelectorAll('.tab-btn');
            const views = document.querySelectorAll('.view');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const viewId = button.getAttribute('data-view');
                    views.forEach(view => view.classList.toggle('active', view.id === viewId));
                });
            });

            function formatAIResponse(text) {
                let html = '';
                const sections = text.split(/\n\s*\n/); 
                sections.forEach(section => {
                    if (section.trim() === '') return;
                    const headingMatch = section.match(/^(\*\*|###?)\s*(.*?)\s*(\*\*|:)/);
                    if (headingMatch) {
                        const title = headingMatch[2].trim();
                        let content = section.substring(headingMatch[0].length).trim();
                        const listItems = content.split('\n').map(item => item.trim().replace(/^[-*]\s*/, ''));
                        if (listItems.length > 1 && listItems.every(item => content.includes(item))) {
                            content = '<ul>' + listItems.map(item => `<li>${item}</li>`).join('') + '</ul>';
                        }
                        html += `<div class="ai-response-card"><h3>${title}</h3><div>${content.replace(/\n/g, '<br>')}</div></div>`;
                    } else {
                        html += `<div class="ai-response-card"><p>${section.trim().replace(/\n/g, '<br>')}</p></div>`;
                    }
                });
                return html;
            }

            function formatChatResponse(text) {
                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold">$1</strong>')
                    .replace(/\n/g, '<br>');
            }

            async function callGeminiAPI(promptOrHistory, resultElement, isChat = false, isTextarea = false) {
                const apiKey = getApiKey();
                if (!apiKey) {
                    alert("Please set your Gemini API Key in the 'Start Here' modal to use AI features.");
                    return;
                }
                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

                const loader = isChat ? document.getElementById(`${activeChat}-chat-loader`) : null;
                if (loader) loader.classList.remove('hidden');
                else if (resultElement) resultElement.innerHTML = '<div class="loader"></div>';

                let payload = Array.isArray(promptOrHistory) ? { contents: promptOrHistory } : { contents: [{ role: "user", parts: [{ text: promptOrHistory }] }] };

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        const errorBody = await response.text();
                        console.error("API Error Body:", errorBody);
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }
                    const data = await response.json();
                    if (data.candidates && data.candidates[0].content) {
                        const text = data.candidates[0].content.parts[0].text;
                        if (isChat) {
                            chatHistory.push({ role: "model", parts: [{ text }] });
                            renderChat();
                        } else if (isTextarea) {
                            resultElement.value = text;
                            if (resultElement.innerHTML) resultElement.innerHTML = ''; 
                        }
                        else {
                            resultElement.innerHTML = formatAIResponse(text);
                        }
                    } else { 
                        console.error("Unexpected API response structure:", data);
                        throw new Error("No content received from API."); 
                    }
                } catch (error) {
                    console.error("Gemini API call failed:", error);
                    const errorHtml = `<div class="text-red-600 p-4 bg-red-100 rounded-lg">Error: Could not get a response. Please check your internet connection and API key. More details in the console.</div>`;
                    if (isChat) document.getElementById(`${activeChat}-chat-history`).innerHTML += errorHtml;
                    else if (resultElement && !isTextarea) resultElement.innerHTML = errorHtml;
                    else if (resultElement && isTextarea) resultElement.placeholder = "Error generating case study.";
                } finally {
                     if (loader) loader.classList.add('hidden');
                }
            }
            
            function renderChat() {
                const historyEl = document.getElementById(`${activeChat}-chat-history`);
                if (!historyEl) return;
                historyEl.innerHTML = '';
                chatHistory.slice(1).forEach(message => {
                    const bubble = document.createElement('div');
                    bubble.classList.add('p-3', 'rounded-lg', 'max-w-xl', 'w-fit');
                    if (message.role === 'user') {
                        bubble.textContent = message.parts[0].text;
                        bubble.classList.add('chat-bubble-user');
                    } else {
                        bubble.innerHTML = formatChatResponse(message.parts[0].text);
                        bubble.classList.add('chat-bubble-model');
                    }
                    historyEl.appendChild(bubble);
                });
                historyEl.scrollTop = historyEl.scrollHeight;
            }
            
            function sendChatMessage() {
                const inputEl = document.getElementById(`${activeChat}-chat-input`);
                if (!inputEl) return;
                const userMessage = inputEl.value.trim();
                if (!userMessage) return;
                chatHistory.push({ role: "user", parts: [{ text: userMessage }] });
                renderChat();
                inputEl.value = '';
                callGeminiAPI(chatHistory, null, true);
            }

            ['cps', 'justice', 'tech', 'env', 'health', 'education', 'politics', 'legacy'].forEach(prefix => {
                const sendBtn = document.getElementById(`${prefix}-chat-send-btn`);
                const input = document.getElementById(`${prefix}-chat-input`);
                if (sendBtn && input) {
                    sendBtn.addEventListener('click', sendChatMessage);
                    input.addEventListener('keypress', (e) => e.key === 'Enter' && sendChatMessage());
                }
            });
            
            document.getElementById('prf-synthesize-btn').addEventListener('click', () => {
                const history = document.getElementById('prf-history').value;
                const beliefs = document.getElementById('prf-beliefs').value;
                const rules = document.getElementById('prf-rules').value;
                const ontology = document.getElementById('prf-ontology').value;
                const authenticity = document.getElementById('prf-authenticity').value;
                const historicalContinuity = document.getElementById('prf-historical-continuity').value;
                const prospectiveCoherence = document.getElementById('prf-prospective-coherence').value;
                const metaCapacity = document.getElementById('prf-meta-capacity').value;

                if (!history || !beliefs || !rules || !ontology || !authenticity || !historicalContinuity || !prospectiveCoherence || !metaCapacity) {
                    alert('Please fill out all fields in the PRF Constructor to synthesize.');
                    return;
                }

                const prompt = `Act as an AI ethics synthesizer based on the FAIM-QIRF framework. A user has mapped their Personal Reality Framework (PRF) and its Adaptive Temporal Consistency Function (ATCF). Your task is to synthesize this information into a coherent, insightful narrative summary of their ethical self.

                User's PRF Input:
                - **Assembly History:** ${history}
                - **BROA Filter - Beliefs:** ${beliefs}
                - **BROA Filter - Rules:** ${rules}
                - **BROA Filter - Ontology:** ${ontology}
                - **BROA Filter - Authenticity:** ${authenticity}
                
                User's ATCF Input:
                - **Historical Continuity:** ${historicalContinuity}
                - **Prospective Coherence:** ${prospectiveCoherence}
                - **Meta-Constructor Capacity:** ${metaCapacity}

                Synthesis Task:
                1.  **Draft a "Personal Reality Framework Summary"**: Weave the user's inputs into a narrative. Start by connecting their Assembly History to their current BROA filter.
                2.  **Provide a "Qualitative ATCF Assessment"**:
                    - Analyze their **Historical Continuity**: How well do they seem to integrate their past into a coherent narrative of evolution and resilience?
                    - Analyze their **Prospective Coherence**: How strong is the alignment between their current self and their future aspirations?
                    - Analyze their **Meta-Constructor Capacity**: How developed is their ability to reflect on and skillfully modify their own framework?
                3.  **Identify Key Tensions & Coherences**: Discuss how their BROA filter and ATCF components seem to work together or create productive friction.
                4.  **Offer a "Forward-Looking Question"**: Conclude with one Socratic question that helps them think about the next step in enhancing their ATCF and overall ethical coherence.`;

                callGeminiAPI(prompt, document.getElementById('prf-result'));
            });


            const ikSynthesizeBtn = document.getElementById('ik-synthesize-btn');
            ikSynthesizeBtn.addEventListener('click', () => {
                const values = document.getElementById('ik-values').value;
                const relationships = document.getElementById('ik-relationships').value;
                const motivations = document.getElementById('ik-motivations').value;
                if (!values || !relationships || !motivations) { alert('Please fill out all three sections.'); return; }
                const prompt = `Synthesize a "Draft Identity Kernel"... Core Values: "${values}", Key Relationships: "${relationships}", Core Motivations: "${motivations}". Synthesize into a 2-3 sentence statement.`;
                callGeminiAPI(prompt, document.getElementById('ik-result'));
            });

            const cpsAnalyzeBtn = document.getElementById('cps-analyze-btn');
            cpsAnalyzeBtn.addEventListener('click', async () => {
                activeChat = 'cps';
                const situation = document.getElementById('cps-situation').value;
                const kernelResult = document.getElementById('ik-result').innerText;
                if (!situation || !kernelResult || kernelResult.includes("Error")) { alert('Please describe your situation and synthesize your Kernel first.'); return; }
                const getAlignmentText = (val) => { if (val < -5) return "strong conflict"; if (val < 0) return "mild conflict"; if (val == 0) return "neutral"; if (val > 5) return "strong coherence"; return "mild coherence"; };
                
                const uevData = {
                    feeling: getAlignmentText(document.getElementById('cps-feeling').value),
                    motivation: getAlignmentText(document.getElementById('cps-motivation').value),
                    reasoning: getAlignmentText(document.getElementById('cps-reasoning').value),
                    action: getAlignmentText(document.getElementById('cps-action').value)
                };

                const initialPrompt = `Act as an AI ethics coach using the FAIM-QIRF framework. A user is analyzing their "Present Integration" via the Unified Experience Vector (UEV).

                - **User's Identity Kernel:** "${kernelResult}"
                - **Ethical Situation:** "${situation}"
                
                - **User's UEV Mapping:**
                  - **Global Feeling Tone:** ${uevData.feeling}
                  - **Emotional Motivation Vector:** ${uevData.motivation}
                  - **Rational Deliberation Vector:** ${uevData.reasoning}
                  - **Action Readiness Vector:** ${uevData.action}

                **Your Task:**
                1.  **Analyze Present Integration:** Provide a brief, insightful analysis of the user's UEV. Point out the most significant area of coherence (where vectors align) and the most significant area of fragmentation (where they conflict).
                2.  **Connect to ATCF:** Explain that this fragmentation is a measure of low "Present Integration," a key component of their overall temporal coherence (ATCF).
                3.  **Pose a Socratic Question:** Ask one focused Socratic question that targets the greatest point of conflict in their UEV to help them improve their internal alignment.`;

                chatHistory = [{ role: "user", parts: [{ text: initialPrompt }] }];
                document.querySelectorAll('[id$="-dialogue-container"]').forEach(el => el.classList.add('hidden'));
                await callGeminiAPI(initialPrompt, document.getElementById('cps-result'));
                document.getElementById('cps-dialogue-container').classList.remove('hidden');
            });

            const broaAnalyzeBtn = document.getElementById('broa-analyze-btn');
            broaAnalyzeBtn.addEventListener('click', () => {
                const situation = document.getElementById('broa-situation').value;
                const beliefs = document.getElementById('broa-beliefs').value;
                const rules = document.getElementById('broa-rules').value;
                const ontology = document.getElementById('broa-ontology').value;
                const authenticity = document.getElementById('broa-authenticity').value;
                if (!situation || !beliefs || !rules || !ontology || !authenticity) { alert('Please fill out all five fields.'); return; }
                const prompt = `Act as an AI ethics coach... Situation: "${situation}"... BROA Filter: Beliefs: "${beliefs}", Rules: "${rules}", Ontology: "${ontology}", Authenticity: "${authenticity}"... Task: Provide a brief, insightful reflection... Conclude with one Socratic question...`;
                callGeminiAPI(prompt, document.getElementById('broa-result'));
            });

            const abcdAnalyzeBtn = document.getElementById('abcd-analyze-btn');
            abcdAnalyzeBtn.addEventListener('click', () => {
                const situation = document.getElementById('abcd-situation').value;
                const agency = document.getElementById('abcd-agency').value;
                const beauty = document.getElementById('abcd-beauty').value;
                const context = document.getElementById('abcd-context').value;
                const dynamism = document.getElementById('abcd-dynamism').value;
                if (!situation || !agency || !beauty || !context || !dynamism) { alert('Please fill out all five fields.'); return; }
                const prompt = `Act as an AI ethics coach... Situation: "${situation}"... ABCD Analysis: Agency: "${agency}", Beauty/Awe: "${beauty}", Context: "${context}", Dynamism: "${dynamism}"... Task: Provide a brief reflection that connects two observations... Conclude with one Socratic question...`;
                callGeminiAPI(prompt, document.getElementById('abcd-result'));
            });

            const sageBrainstormBtn = document.getElementById('sage-brainstorm-btn');
            sageBrainstormBtn.addEventListener('click', () => {
                const see = document.getElementById('sage-see').value;
                const analyze = document.getElementById('sage-analyze').value;
                if (!see || !analyze) { alert('Please complete the "See" and "Analyze" steps first.'); return; }
                const prompt = `Act as an AI brainstorming partner... Problem/System (See): "${see}"... Root Cause Analysis (Analyze): "${analyze}"... Your Task: Generate a diverse list of 5-7 creative, ethical solutions...`;
                callGeminiAPI(prompt, document.getElementById('sage-result'));
            });

            const lensAnalyzeBtn = document.getElementById('lens-analyze-btn');
            lensAnalyzeBtn.addEventListener('click', () => {
                const situation = document.getElementById('lens-situation').value;
                const kernelResult = document.getElementById('ik-result').innerText;
                if (!situation) { alert('Please describe the ethical situation.'); return; }
                if (!kernelResult || kernelResult.includes("Error")) { alert('Please synthesize your Identity Kernel on the CPS Dashboard tab first. The triangulation requires it.'); return; }
                const prompt = `A student is using the Ethical Lens Navigator. First, analyze their dilemma through the four classical lenses. Second, provide a new, concluding section called "Ethical Triangulation & Coherence" that synthesizes the analysis. Student's Identity Kernel: "${kernelResult}"... Dilemma: "${situation}"... Part 1: Four Lenses Analysis... Part 2: Ethical Triangulation & Coherence...`;
                callGeminiAPI(prompt, document.getElementById('lens-result'));
            });

            // --- Generic System Cartography Logic ---
            const setupCartographyLab = (prefix) => {
                const generateCaseBtn = document.getElementById(`${prefix}-generate-case-btn`);
                generateCaseBtn.addEventListener('click', () => {
                    const prompt = `Generate a complex case study for a college-level ${prefix.charAt(0).toUpperCase() + prefix.slice(1)} System Cartography Lab...`;
                    callGeminiAPI(prompt, document.getElementById(`${prefix}-case-study`), false, true);
                });

                const analyzeBtn = document.getElementById(`${prefix}-analyze-btn`);
                analyzeBtn.addEventListener('click', async () => {
                    activeChat = prefix;
                    const caseStudy = document.getElementById(`${prefix}-case-study`).value;
                    const map = document.getElementById(`${prefix}-map`).value;
                    const tensions = document.getElementById(`${prefix}-tensions`) ? document.getElementById(`${prefix}-tensions`).value : (document.getElementById(`${prefix}-types`) ? document.getElementById(`${prefix}-types`).value : document.getElementById(`${prefix}-values`).value);
                    const intervention = document.getElementById(`${prefix}-intervention`).value;
                    if (!caseStudy || !map || !tensions || !intervention) { alert('Please ensure the case study and all three analysis fields are filled out.'); return; }
                    const initialPrompt = `Act as an AI ethics coach. A student has completed a ${prefix.charAt(0).toUpperCase() + prefix.slice(1)} System Cartography analysis... Case Study: "${caseStudy}"... Student's Analysis: 1. Map: "${map}", 2. Tensions/Types/Values: "${tensions}", 3. Intervention: "${intervention}"... Your Task: Provide constructive feedback...`;
                    chatHistory = [{ role: "user", parts: [{ text: initialPrompt }] }];
                    document.querySelectorAll('[id$="-dialogue-container"]').forEach(el => el.classList.add('hidden'));
                    await callGeminiAPI(initialPrompt, document.getElementById(`${prefix}-result`));
                    document.getElementById(`${prefix}-synergy-container`).classList.remove('synergy-lab-locked');
                    document.getElementById(`${prefix}-dialogue-container`).classList.remove('hidden');
                });

                const synergyAnalyzeBtn = document.getElementById(`${prefix}-synergy-analyze-btn`);
                synergyAnalyzeBtn.addEventListener('click', async () => {
                    activeChat = prefix;
                    const scale = document.getElementById(`${prefix}-synergy-scale`).value;
                    const conflicts = document.getElementById(`${prefix}-synergy-conflicts`).value;
                    const capability = document.getElementById(`${prefix}-synergy-capability`).value;
                    const fef = document.getElementById(`${prefix}-synergy-fef`).value;
                    if (!scale || !conflicts || !capability || !fef) { alert('Please fill out all four fields in the Synergy Lab.'); return; }
                    const synergyPrompt = `Now, let's deepen this analysis using the FAIM-QIRF framework's Cross-Scale Coordination & Synergy Lab. Here are my thoughts:
                    - **Primary Scale & Lenses:** ${scale}
                    - **Cross-Scale Conflicts:** ${conflicts}
                    - **Capability Proposition:** ${capability}
                    - **Functional Equivalence (FEF):** ${fef}
                    
                    Please act as an advanced AI coach. Based on my Synergy Lab input, provide a deeper analysis.
                    1.  Evaluate the resilience of my proposed moral innovation. How well does it account for cross-scale conflicts?
                    2.  How could the **capability proposition** be strengthened to better enable coordination between agents with different PRFs?
                    3.  Does the **functional equivalence** argument create a robust, non-moral justification that can appeal to a wider range of stakeholders?
                    4.  Conclude with a final Socratic question to guide my next steps as a constructor.`;
                    chatHistory.push({ role: "user", parts: [{ text: synergyPrompt }] });
                    renderChat();
                    callGeminiAPI(chatHistory, null, true);
                });
            };

            ['justice', 'tech', 'env', 'health', 'education', 'politics'].forEach(prefix => {
                setupCartographyLab(prefix);
            });

            const legacyAnalyzeBtn = document.getElementById('legacy-analyze-btn');
            legacyAnalyzeBtn.addEventListener('click', async () => {
                activeChat = 'legacy';
                const innovation = document.getElementById('legacy-innovation').value;
                const insights = document.getElementById('legacy-insights').value;
                const statement = document.getElementById('legacy-statement').value;
                const kernel = document.getElementById('ik-result').innerText || "not yet synthesized";
                const metaCapacity = document.getElementById('prf-meta-capacity').value || "not yet described";

                if (!innovation || !insights || !statement) { alert('Please fill out all three sections of your Legacy Project.'); return; }
                
                const initialPrompt = `Act as an AI ethics professor providing final, holistic feedback on a student's capstone 'Legacy Project,' using the FAIM-QIRF framework.
                
                - **Student's Identity Kernel:** "${kernel}"
                - **Student's Stated Meta-Constructor Capacity:** "${metaCapacity}"

                - **Student's Project Synthesis:**
                  1.  **Moral Innovation:** "${innovation}"
                  2.  **Key Insights:** "${insights}"
                  3.  **Legacy Statement:** "${statement}"

                **Your Task: Provide a final, capstone analysis.**
                1.  **Acknowledge Coherence:** Validate the coherence of their project. How does their proposed innovation connect to their Identity Kernel and demonstrate their **Meta-Constructor Capacity** in action?
                2.  **Reflect on Legacy:** Reflect on the strength of their legacy statement. How well does it articulate a goal of building new **capabilities for coordination and coherence** in others?
                3.  **Offer a Final Question:** Conclude with one final, forward-looking Socratic question that encourages them to consider the ongoing, lifelong nature of being an ethical **meta-constructor**.`;

                chatHistory = [{ role: "user", parts: [{ text: initialPrompt }] }];
                document.querySelectorAll('[id$="-dialogue-container"]').forEach(el => el.classList.add('hidden'));
                await callGeminiAPI(initialPrompt, document.getElementById('legacy-result'));
                document.getElementById('legacy-dialogue-container').classList.remove('hidden');
            });

            const loadDemo = () => {
                isDemoMode = true;
                const demoData = {
                    prf: { history: "I grew up in a small town where community and mutual support were highly valued. However, a formative experience in college involved witnessing a friend being unfairly accused of plagiarism due to a misunderstanding of cultural citation practices, which made me deeply skeptical of rigid, one-size-fits-all rule systems.", beliefs: "I believe that context is more important than rigid rules and that most people are trying their best given their circumstances.", rules: "The primary rule is to seek understanding before judgment. Another rule is that systems should be flexible enough to accommodate human complexity.", ontology: "I see ethical dilemmas not as simple right-vs-wrong choices, but as complex systems of interacting needs, histories, and power dynamics.", authenticity: "It feels most authentic to me to act as a mediator or a bridge-builder, rather than an enforcer of rules.", 'historical-continuity': "My framework is challenged when I encounter situations of clear, intentional harm, as my bias towards understanding can make it hard to set firm boundaries. It evolved from a simple 'be nice to people' to a more complex 'build just and compassionate systems' after my friend's plagiarism case.", 'prospective-coherence': "I want my framework to become more robust in confronting bad actors without losing its core of compassion. I need to develop a better 'Art of the Enemy' practice.", 'meta-capacity': "I reflect on my framework when I feel a strong internal conflict between a rule and my sense of authenticity. I usually journal about it, talk to a trusted friend who sees the world differently, and try to find a higher-level principle that can hold both perspectives in tension." },
                    ik: { values: "I value loyalty to my friends, but also academic honesty and personal integrity.", relationships: "My friendship with Alex is really important to me, as is my standing as a trustworthy student in my academic community.", motivations: "I'm motivated to help my friends succeed, but I also have a deep drive to be a person who earns their achievements fairly." },
                    cps: { situation: "My close friend Alex is overwhelmed and falling behind. They've asked me to let them copy my answers for a major assignment that's due tomorrow. I know they're struggling, but I feel it's wrong to cheat.", feeling: -8, motivation: -5, reasoning: 7, action: -3 },
                    broa: { situation: "My close friend Alex is overwhelmed and falling behind. They've asked me to let them copy my answers for a major assignment that's due tomorrow. I know they're struggling, but I feel it's wrong to cheat.", beliefs: "I believe that true friendship means helping someone, but I also believe that learning requires personal effort and that cheating devalues everyone's work.", rules: "The explicit rule is 'do not cheat.' The implicit social rule is 'be loyal to your friends.' These rules are in direct conflict.", ontology: "I see this as a test of my integrity. I also see it as a cry for help from a friend who is struggling with a system that is overwhelming them.", authenticity: "Letting Alex cheat feels fundamentally inauthentic and dishonest to me. But abandoning a friend in need also feels like a betrayal of who I am." },
                    abcd: { situation: "My close friend Alex is overwhelmed and falling behind. They've asked me to let them copy my answers for a major assignment that's due tomorrow. I know they're struggling, but I feel it's wrong to cheat.", agency: "Alex has the agency to ask for help, and I have the agency to say yes, no, or offer a different kind of help. The professor and the school also have agency in creating the conditions for this dilemma.", beauty: "The value of our friendship is beautiful and worth protecting. So is the value of academic integrity and the personal growth that comes from honest work.", context: "The context is that Alex is under immense pressure from family and the competitive school environment. This isn't just about one assignment; it's about a system that can push students to desperate measures.", dynamism: "If I help them cheat, the immediate situation is resolved, but it might create a dynamic where they rely on me, or it could damage our trust if we're caught. Refusing could strain our friendship now, but might lead to a more honest conversation about the pressures we're facing." },
                    sage: { see: "The immediate problem is my friend asking to cheat. The larger system is the high-pressure academic environment at our school that normalizes extreme stress and creates incentives for academic dishonesty.", analyze: "Root causes include: a competitive 'weed-out' culture in our major, inadequate mental health and academic support services, and a grading system that rewards performance over genuine learning and collaboration.", generate: "Possible solutions: 1. Offer to spend the evening tutoring Alex instead of giving them the answers. 2. Together, approach the professor to ask for an extension for Alex, explaining the situation without making excuses. 3. Start a student group to advocate for better mental health resources or a more collaborative academic culture.", evaluate: "Tutoring Alex directly helps my friend and maintains my integrity (low risk, high relational reward). Asking the professor is riskier but could help Alex without compromising academic honesty. Starting a student group is a long-term, high-impact solution that addresses the root cause but doesn't solve the immediate crisis." },
                    justice: { 'case-study': "The university's Academic Integrity Committee is reviewing the case of Alex, who was caught submitting plagiarized work provided by another student. The standard policy mandates a zero on the assignment and a formal notation on their academic record. However, Alex has presented evidence that they were suffering from a severe mental health crisis, were not receiving adequate support from the university's over-burdened counseling services, and felt this was the only way to avoid failing the course and losing their scholarship. The committee must decide whether to follow the standard procedure or consider a more lenient, restorative approach.", map: "Stakeholders: Alex, myself (the friend), the professor, the Academic Integrity Committee, the university administration, and other students. Power is concentrated in the Committee, which follows rules set by the administration. Alex has very little power. The historical context is a campus culture that prizes high achievement but fails to adequately support student well-being, creating a feedback loop where stress leads to academic dishonesty.", types: "The standard policy is purely Retributive Justice (punishment for a rule violation). Alex's situation brings up questions of Procedural Justice (was the process fair, given their mental state?) and Distributive Justice (are support resources distributed fairly across the student body?). A restorative approach would introduce Compensatory Justice (how can Alex repair the harm done?).", intervention: "I propose a two-tiered system. For first-time offenses where mitigating circumstances like a documented mental health crisis exist, the case should be referred to a restorative justice circle instead of the punitive committee. This circle would include the student, professor, and a trained mediator. The goal would be to create a plan for Alex to learn from the mistake, get connected to real support, and repair the harm to the professor's trust, rather than simply being punished. This maintains accountability while being more compassionate and addressing the root cause." },
                    'justice-synergy': { scale: "My intervention is primarily at the Institutional scale, aiming to change the university's formal procedures. The most appropriate lenses here are Procedural Justice and Rights Protection.", conflicts: "My institutional solution (a restorative justice circle) might conflict with the National scale if there are rigid federal guidelines for academic misconduct. It could also conflict with the Individual scale if a professor feels their authority is undermined by a non-punitive process.", capability: "This intervention creates the capability for students to learn from mistakes without catastrophic failure, the capability for faculty to exercise compassion within a structured process, and the capability for the institution to learn from patterns of student distress.", fef: "From a purely risk-management perspective, this intervention is also superior. It reduces the risk of lawsuits from students who feel unfairly treated, lowers the chance of negative press from a harsh disciplinary action, and improves long-term student retention by addressing crises constructively instead of punitively." },
                    tech: { 'case-study': "To address the student mental health crisis that led to Alex's academic dishonesty, the university is proposing a new wellness app. The app uses an AI to monitor students' digital activity (like late-night study patterns, social media sentiment, and withdrawn communication) to proactively identify students at risk and offer them resources. The data would be anonymized but managed by the university's tech department. Some students feel this is a helpful, proactive solution, while others see it as a dangerous form of surveillance that violates privacy and could be used for disciplinary purposes.", map: "The system includes students (users), the university administration (designers/implementers), counseling services (resource providers), and the AI vendor (third party). The goal is student wellness, but the feedback loop involves collecting personal data to trigger an intervention. A major power imbalance exists between the students and the university.", values: "The design values efficiency and proactive intervention. However, it potentially devalues student privacy, autonomy, and consent. It could impact a student's CPS by creating a feeling of being constantly watched (anxiety), motivating them to hide their true feelings (inauthenticity), and undermining their trust in the university's support systems.", intervention: "I propose an 'opt-in by design' model. The app should not be a default installation. Instead, it should be offered transparently during orientation, with clear explanations of what data is collected and how it is used. Furthermore, students should have a 'data dashboard' where they can see their own data and control what information is shared with counselors, giving them more agency in the process." },
                    'tech-synergy': { scale: "My intervention is primarily at the Institutional scale (university policy) and the Individual scale (student consent). The appropriate lenses are Rights Protection (privacy) and Care Ethics (student well-being).", conflicts: "My 'opt-in' model might conflict with the university's goal of universal monitoring (Institutional scale). It also creates a conflict at the Community scale, as some students might feel pressured to opt-in to avoid being seen as 'uncooperative.'", capability: "This design gives students the capability to control their own data and make informed choices about their privacy. It gives the university the capability to offer support without resorting to surveillance, building a more trusting relationship.", fef: "From a legal liability perspective (a pragmatic argument), an opt-in model is far safer for the university. It drastically reduces the risk of lawsuits related to privacy violations or data breaches, making it the most prudent choice even if one doesn't prioritize student autonomy." },
                    env: { 'case-study': "The university, in its effort to build a new, state-of-the-art wellness center to address the student mental health crisis, has proposed building on a 5-acre plot of undeveloped land it owns on the edge of campus. This land, however, contains a small, protected wetland that is a habitat for several local bird species and acts as a natural filter for storm runoff into the local watershed. A student environmental group has protested, arguing that destroying the wetland for a building—even a much-needed one—is unethical. The university argues that this is the only available land and that the wellness center's benefit to student mental health outweighs the environmental impact.", map: "Stakeholders include students (needing mental health services), the university administration (focused on development and student welfare), the student environmental group (advocates for the ecosystem), local bird species (non-human stakeholders), and downstream communities who rely on the watershed. The key feedback loop is that increased student stress creates demand for a wellness center, the construction of which could degrade the natural environment that might otherwise alleviate stress.", tensions: "The core tension is between human-centered well-being (student mental health) and ecological well-being (preserving the wetland). It's a conflict between present, urgent human needs and long-term, multi-species environmental integrity. It also involves a tension between the university's property rights and its stewardship responsibilities.", intervention: "I propose a 'regenerative' design intervention. Instead of clear-cutting the land, the university should be required to build a 'Living Building' wellness center. This design would integrate with the landscape, use green roofs and reclaimed water systems to support the wetland, and incorporate the natural space into its therapeutic programs (e.g., mindfulness trails). This creates a positive feedback loop where the building enhances both student wellness and ecological health." },
                    'env-synergy': { scale: "My intervention is at the Institutional scale (university building policy) and the Community scale (how students interact with their environment). The appropriate lenses are Environmental Harmony and Care Ethics.", conflicts: "This solution might conflict with the National scale if federal funding for the building has strict, conventional construction requirements. It could also create conflict at the Individual scale if some students feel the 'regenerative' design compromises the size or amenities of the facility.", capability: "This intervention creates the capability for the university to model sustainable development. It gives students the capability to connect their mental health with their natural environment. It gives the local ecosystem the capability to persist and even thrive alongside human development.", fef: "From a purely financial standpoint, a 'Living Building' can be framed as a long-term risk management strategy. It would generate significant positive press, attract environmentally-conscious students and donors, and have lower long-term operating costs due to energy and water efficiency, making it a wise investment regardless of one's commitment to ecological ethics." },
                    health: { 'case-study': "A rural hospital with limited ICU beds is facing a surge in patients from a new, highly contagious virus. They must decide on a policy for allocating the last available ventilator. The candidates are a 75-year-old grandfather with multiple co-morbidities but strong family support, and a 25-year-old single parent of two young children who has a higher chance of a quick recovery but was not following public health guidelines. The hospital's official policy is to prioritize patients with the highest chance of survival, but the clinical team is deeply divided, with some arguing for a more holistic, community-focused approach.", map: "Stakeholders: The two patients, their families, the clinical team (doctors, nurses), the hospital ethics committee, the hospital administration (concerned with liability and resources), and the broader community. The key feedback loop is that a strict, utilitarian allocation policy might maximize 'lives saved' in the short term but could erode community trust in the hospital long-term, leading to worse health outcomes as people avoid seeking care.", tensions: "The core tension is between a Consequentialist approach (maximizing survival) and a Care Ethics approach (considering relational ties and community impact). There is also a Justice tension: is it fair to penalize the 25-year-old for their past choices, or should resources be distributed based on future potential and responsibilities (care for their children)?", intervention: "I propose a 'weighted criteria' intervention. Instead of a single-factor policy (best chance of survival), the ethics committee should use a multi-factor scoring system that includes prognosis, but also gives weight to other factors like dependents (Care Ethics) and a fair process for all (Procedural Justice). This system would be transparently communicated to the community to build trust." },
                    'health-synergy': { scale: "My intervention is at the Institutional scale (hospital policy). The appropriate lenses are Procedural Justice and Care Ethics, as it involves creating a fair process that is sensitive to relational contexts.", conflicts: "This institutional policy could conflict with the National scale if federal emergency guidelines mandate a strict utilitarian allocation model. It could also conflict with the Individual scale if a family feels the 'weighted' criteria unfairly disadvantaged their loved one, leading to legal challenges.", capability: "This intervention gives the hospital the capability to make tragic decisions in a way that is more ethically robust and defensible. It gives clinicians the capability to honor their complex duties beyond a simple algorithm. It gives the community the capability to see that the hospital's decision-making process is thoughtful and just, even when the outcomes are tragic.", fef: "From a purely legal risk-management perspective, a transparent, multi-factor allocation policy is superior. A single-factor policy is highly vulnerable to lawsuits claiming discrimination (e.g., against the elderly or disabled). A documented, multi-factor process that balances multiple ethical considerations provides a much stronger legal defense, demonstrating that the hospital acted with due care and diligence." },
                    education: { 'case-study': "In response to the student mental health crisis (which led to Alex's academic dishonesty), the university is considering a mandatory 'pass/fail' grading system for all first-year introductory courses. Proponents argue this will lower stress, encourage exploration, and reduce the competitive pressures that lead to cheating. Opponents, including some faculty and pre-med students, argue that it will devalue achievement, make it harder for high-achieving students to stand out for graduate school applications, and remove important feedback mechanisms for academic improvement.", map: "Stakeholders: First-year students, upper-level students, faculty, administrators, graduate school admissions committees, and employers. The key feedback loop is the tension between student well-being and traditional metrics of academic excellence. A system designed to maximize well-being might reduce the legible signals of excellence that other systems (like grad schools) rely on.", tensions: "The core tension is between the value of student well-being and the value of meritocratic achievement. There's also a conflict between creating an equitable, less stressful environment for all (a Community-scale goal) and preserving the ability of individuals to differentiate themselves (an Individual-scale goal).", intervention: "I propose a 'structured choice' model. All first-year students are enrolled in courses as pass/fail by default. However, after the mid-term period, any student has the one-time option to convert their final grade to a traditional letter grade. This preserves the low-stress exploratory period for all, while still allowing students who need or want the differentiation to opt-in, making their agency and goals visible." },
                    'education-synergy': { scale: "My intervention is at the Institutional scale (university grading policy) and the Individual scale (student choice). The appropriate lenses are Rights Protection (the right to choose one's evaluation method) and Procedural Justice (creating a fair process for all).", conflicts: "This solution might create a new Community-scale conflict, where a social norm develops that 'serious' students always opt-in to letter grades, recreating the original stress and competition. It could also conflict with the Institutional scale if it creates significant administrative complexity.", capability: "This intervention gives students the capability to self-assess their goals and learning needs mid-semester. It gives the institution the capability to support student well-being without completely abandoning traditional evaluation metrics. It creates a new capability for dialogue between students and advisors about the purpose of grades.", fef: "From a purely market-driven perspective, this 'structured choice' model is a powerful marketing tool. The university can brand itself as an innovative leader in student-centered education, attracting students who want both well-being and high achievement. This enhances the university's reputation and enrollment numbers, regardless of the direct pedagogical benefits." },
                    politics: { 'case-study': "The university student government, in response to the events of the academic integrity and wellness app cases, is debating a new 'Student Bill of Rights.' One proposed right is 'the right to a voice in university governance,' which would require student representatives on key administrative committees, including the one that sets tuition and the one that oversees disciplinary policy. The university administration is pushing back, arguing that while they value student input, students are temporary members of the community and lack the long-term perspective and expertise needed for these high-stakes decisions. They are proposing an 'advisory board' with no voting power instead.", map: "Stakeholders: Current students, future students, alumni, the student government, the university administration, the Board of Trustees, and faculty. The key feedback loop is the tension between student demands for democratic participation and the administration's desire for centralized, expert control. A lack of student power can lead to policies that generate widespread student distress, which in turn fuels more demands for participation.", tensions: "The core tension is between democratic legitimacy (power derived from the consent of the governed, i.e., the students) and technocratic authority (power derived from expertise and institutional position). It's a conflict between the values of participation and efficiency, and between the rights of community members and the authority of institutional leaders.", intervention: "I propose a 'co-governance' model as a constructive intervention. For key committees like the disciplinary and wellness committees, there should be designated student seats with full voting power. To address the administration's concern about expertise, these student representatives would be required to complete a mandatory training program on university finance and policy. This model shares power while also building student capability, creating a more resilient and legitimate system." },
                    'politics-synergy': { scale: "My intervention is at the Institutional scale, redesigning the university's governance structure. The appropriate lenses are Rights Protection (the right to choose one's evaluation method) and Procedural Justice (creating a fair process for all).", conflicts: "This model could create a conflict with the National scale if accrediting bodies have strict rules about the composition of governing committees. It could also create a Community-scale conflict if different student factions compete intensely for these new positions of power, leading to political polarization within the student body.", capability: "This intervention gives students the capability to participate meaningfully in the decisions that shape their lives. It gives the administration the capability to make more informed and legitimate decisions that have greater student buy-in. It creates the capability for the entire university to become a laboratory for democratic practice.", fef: "From a brand and marketing perspective, a 'co-governance' model is a powerful differentiator. The university can market itself as a leader in student empowerment and democratic education, attracting top students who want to be active participants in their community. This enhances the university's prestige and reputation, making it a strategic move regardless of one's commitment to democratic principles." },
                    legacy: { innovation: "My moral innovation is the 'structured choice' model for first-year grading, developed in the Education Lab. The core idea is to make pass/fail the default to lower stress, while allowing students to opt-in to a letter grade after mid-terms. This balances the systemic need for well-being with the individual need for differentiation.", insights: "This innovation directly reflects my Identity Kernel's values of compassion and integrity. My BROA analysis showed that the 'problem' of academic dishonesty is also a 'cry for help' from a stressful system. My ABCD analysis highlighted the need to see the broader context of student pressure. This intervention is a direct response to those insights, aiming to build a more supportive system rather than just punishing individuals.", statement: "My legacy as a constructor is to design systems that create the capability for others to flourish without sacrificing their ethical coherence or well-being. I want to build regenerative structures that are not only fair and efficient, but also compassionate and sensitive to the embodied experience of the agents within them." }
                };
                
                // Populate all fields
                allSavableFields.forEach(field => {
                    const id = field.id;
                    for (const labKey in demoData) {
                        if (typeof demoData[labKey] === 'object' && demoData[labKey] !== null) {
                            for (const fieldKey in demoData[labKey]) {
                                let constructedId = `${labKey.replace('_synergy', '-synergy')}-${fieldKey.replace('case','case-study')}`;
                                if (id === constructedId) {
                                    field.value = demoData[labKey][fieldKey];
                                }
                            }
                        }
                    }
                });
                
                // Show "Return to My Project" button
                actionButtons.innerHTML = `
                    <button id="return-to-work-btn" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-blue-700 transition-colors">Return to My Project</button>
                    <button id="clear-work-btn" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-red-700 transition-colors">Clear My Work</button>
                `;
                document.getElementById('return-to-work-btn').addEventListener('click', returnToWork);
                document.getElementById('clear-work-btn').addEventListener('click', clearWork);
            };

            function returnToWork() {
                isDemoMode = false;
                // Clear the fields before loading saved work
                allSavableFields.forEach(field => {
                    if (field.type === 'range') field.value = 0;
                    else field.value = '';
                });
                loadWork(); 
                // Restore original buttons
                actionButtons.innerHTML = `
                    <button id="start-here-btn" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-blue-700 transition-colors">Start Here</button>
                    <button id="abcd-mindset-btn" class="bg-teal-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-teal-700 transition-colors">ABCD Constructor's Mindset</button>
                    <button id="load-demo-btn" class="bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-gray-600 transition-colors">Load Demo</button>
                    <button id="clear-work-btn" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-lg shadow-sm hover:bg-red-700 transition-colors">Clear My Work</button>
                `;
                document.getElementById('load-demo-btn').addEventListener('click', loadDemo);
                document.getElementById('clear-work-btn').addEventListener('click', clearWork);
                document.getElementById('start-here-btn').addEventListener('click', () => openModal(startHereModal));
                document.getElementById('abcd-mindset-btn').addEventListener('click', () => {
                    populateAbcdPrompts();
                    openModal(abcdMindsetModal);
                });

            }

            document.getElementById('load-demo-btn').addEventListener('click', loadDemo);

            // Initial load of saved work and API Key status
            loadWork();
            updateApiKeyStatus();
        });
    </script>
</body>
</html>
